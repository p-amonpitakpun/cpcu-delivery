(this["webpackJsonpsenior-frontend"]=this["webpackJsonpsenior-frontend"]||[]).push([[0],{15:function(t,e,a){t.exports={Page:"style_Page__1J22r",Box:"style_Box__yrZPo",Robot:"style_Robot__1aAbD",HeadText:"style_HeadText__3vMN5",typing:"style_typing__22jCa","blink-caret":"style_blink-caret__1O4bU",HeadTextWrong:"style_HeadTextWrong__1Y6m1",typing2:"style_typing2__1nGmE",HeadTextPass:"style_HeadTextPass__1pKzl",typing3:"style_typing3__1kl4R",textinput:"style_textinput__2nqW_",submit:"style_submit__3EEMG"}},2:function(t,e,a){t.exports={Page:"style_Page__3lO_-",Beautifulmap:"style_Beautifulmap__1VnyD",currentPos:"style_currentPos__3kHNH",columnContainer:"style_columnContainer__Nq6Aw",logout:"style_logout__WqGgL",namebox:"style_namebox__Zz_KD",name:"style_name__eptz7",debug:"style_debug__1_nzi",debug2:"style_debug2__1UosV",toggleButton:"style_toggleButton__3bRhi",right:"style_right__3m7Vc",toggleDot:"style_toggleDot__2IX_X",togglePane:"style_togglePane__2fEDe",secHead:"style_secHead__1LBo2",currentClick:"style_currentClick__1M8ll",targetClick:"style_targetClick__2HQyJ",targetPath:"style_targetPath__XqbWP",statusText:"style_statusText__1VnBN",greenText:"style_greenText__32yGO",yellowText:"style_yellowText__1w9gn",greyText:"style_greyText__1krqe",blueText:"style_blueText__18sU_",statusBox:"style_statusBox__34BN8",high:"style_high__XHLtT"}},95:function(t,e,a){},96:function(t,e,a){"use strict";a.r(e);var s=a(1),n=a.n(s),r=a(52),o=a.n(r),c=a(23),i=a(3),u=a(5),l=a.n(u),d=a(14),p=a(24),h=a(25),b=a(27),j=a(26),m=a(15),_=a.n(m),x=a.p+"static/media/robot.d00afd71.png",g=function(){return localStorage.getItem("auth")},v={sendPost:function(){var t=Object(d.a)(l.a.mark((function t(e,a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat("/api/").concat(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(g())},body:JSON.stringify(a)});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),sendGet:function(){var t=Object(d.a)(l.a.mark((function t(e,a){var s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=new URL("".concat("/api/").concat(e)),a&&Object.keys(a).forEach((function(t){return s.searchParams.append(t,a[t])})),t.next=4,fetch(s,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(g())}});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()},f=a(0),y=function(t){Object(b.a)(a,t);var e=Object(j.a)(a);function a(){var t;Object(p.a)(this,a);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))).state={status:0,username:"",password:""},t.renderHead=function(){return 0===t.state.status?Object(f.jsx)("div",{className:_.a.HeadText,children:'"Who ..  are .. you .. ?"'}):1===t.state.status?Object(f.jsx)("div",{className:_.a.HeadTextWrong,children:'"Wrong .. Credential .. !"'}):2===t.state.status?Object(f.jsx)("div",{className:_.a.HeadTextPass,children:'"Welcome .. :)"'}):void 0},t.submitLogin=function(){var e=Object(d.a)(l.a.mark((function e(a){var s,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,v.sendPost("auth",{username:t.state.username,password:t.state.password});case 3:if(200===(s=e.sent).status){e.next=8;break}t.setState({status:1}),e.next=14;break;case 8:return e.next=10,s.json();case 10:n=e.sent,localStorage.setItem("auth",n.token),t.setState({status:2}),setTimeout((function(){t.props.history.push("/robot")}),3e3);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.handleText=function(e,a){var s={};s[a]=e.currentTarget.value,t.setState(s)},t.loginResult=function(t,e){return t===e},t}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var t=Object(d.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.sendGet("whoami",{a:"b"});case 2:200===t.sent.status&&this.props.history.push("/robot");case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return Object(f.jsx)("div",{className:_.a.Page,children:Object(f.jsxs)("div",{className:_.a.Box,children:[Object(f.jsx)("img",{src:x,className:_.a.Robot}),this.renderHead(),2!==this.state.status&&Object(f.jsxs)("form",{onSubmit:this.submitLogin,children:[Object(f.jsx)("input",{placeholder:"Username",onChange:function(e){return t.handleText(e,"username")},value:this.state.username,type:"text",className:_.a.textinput}),Object(f.jsx)("input",{placeholder:"Password",onChange:function(e){return t.handleText(e,"password")},value:this.state.password,type:"password",className:_.a.textinput}),Object(f.jsx)("input",{type:"submit",className:_.a.submit,value:"Enter"})]})]})})}}]),a}(n.a.Component),O=Object(i.f)(y),k=a(2),C=a.n(k),N=a.p+"static/media/bck.6a169fe7.jpg",S=a(54),w={1:[262,244],2:[253,333]},P=function(t){Object(b.a)(a,t);var e=Object(j.a)(a);function a(){var t;Object(p.a)(this,a);for(var s=arguments.length,r=new Array(s),o=0;o<s;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).state={maptype:0,occupancy_map:"",selectroom:"1",current_user:null,clicked_coordinate:[0,0],robot_current_state:{status:0,position:[0,0],target:null,path:[],user:"User1"},voicestate:!1,socket:null,audioContext:null,myStream:null,scriptProcessor:null,detected:""},t.controlpanel=function(){return 0===t.state.robot_current_state.status?Object(f.jsxs)(n.a.Fragment,{children:[Object(f.jsx)("div",{className:C.a.high,children:"Voice(Beta)"}),Object(f.jsx)("div",{children:"Press the button, then speak one of these 2 phrases and press stop"}),Object(f.jsx)("div",{children:"- Deliver object to room one"}),Object(f.jsx)("div",{children:"- Deliver object to room two"}),Object(f.jsx)("button",{onClick:t.recbuttHan,children:t.state.voicestate?"Stop recording":"Start recording"}),Object(f.jsx)("div",{className:C.a.high,children:"Basic control(specify room)"}),Object(f.jsx)("div",{children:"Move to Room"}),Object(f.jsx)("select",{value:t.state.selectroom,onChange:function(e){t.setState({selectroom:e.currentTarget.value})},children:t.roomoptions()}),Object(f.jsx)("button",{onClick:t.moveRoom,children:"Go"}),Object(f.jsx)("div",{className:C.a.high,children:"Advanced control(specify coordinate)"}),Object(f.jsx)("div",{children:"Click on the map the point to get coordinate"}),Object(f.jsxs)("div",{children:["X: ",t.state.clicked_coordinate[0]]}),Object(f.jsxs)("div",{children:["Y: ",t.state.clicked_coordinate[1]]}),Object(f.jsx)("button",{onClick:t.move,children:"Go"})]}):1===t.state.robot_current_state.status?Object(f.jsxs)(n.a.Fragment,{children:[Object(f.jsx)("div",{className:C.a.high,children:"Voice(Beta)"}),Object(f.jsx)("div",{children:"Press the button, then speak one of these 2 phrases and press stop"}),Object(f.jsx)("div",{children:"- Pause delivery"}),Object(f.jsx)("div",{children:"- Stop delivery"}),Object(f.jsx)("button",{onClick:t.recbuttHan,children:t.state.voicestate?"Stop recording":"Start recording"}),Object(f.jsx)("div",{className:C.a.high,children:"Pause or cancel"}),Object(f.jsx)("button",{onClick:t.pause,children:"Pause"}),Object(f.jsx)("button",{onClick:t.stop,children:"Stop/Cancel"})]}):2===t.state.robot_current_state.status?Object(f.jsxs)(n.a.Fragment,{children:[Object(f.jsx)("div",{className:C.a.high,children:"Voice(Beta)"}),Object(f.jsx)("div",{children:"Press the button, then speak one of these 2 phrases and press stop"}),Object(f.jsx)("div",{children:"Resume delivery"}),Object(f.jsx)("div",{children:"Stop delivery"}),Object(f.jsx)("button",{onClick:t.recbuttHan,children:t.state.voicestate?"Stop recording":"Start recording"}),Object(f.jsx)("div",{className:C.a.high,children:"Resume or cancel"}),Object(f.jsx)("button",{onClick:t.resume,children:"Resume"}),Object(f.jsx)("button",{onClick:t.stop,children:"Stop/Cancel"})]}):void 0},t.roomoptions=function(){return Object.keys(w).map((function(t){return Object(f.jsx)("option",{label:t,value:t,children:t},t)}))},t.clickMap=function(e){var a=e.currentTarget.getBoundingClientRect(),s=Math.round(e.clientX-a.left),n=Math.round(e.clientY-a.top);t.setState({clicked_coordinate:[s,n]})},t.logOut=function(){localStorage.removeItem("auth"),t.props.history.push("/")},t.renderInsideMap=function(){return Object(f.jsxs)(n.a.Fragment,{children:[Object(f.jsx)("img",{src:x,className:C.a.currentPos,style:{top:"".concat(t.state.robot_current_state.position[1]-12,"px"),left:"".concat(t.state.robot_current_state.position[0]-12,"px")}}),0===t.state.robot_current_state.status&&Object(f.jsx)("div",{className:C.a.currentClick,style:{top:"".concat(t.state.clicked_coordinate[1]-5,"px"),left:"".concat(t.state.clicked_coordinate[0]-5,"px")}}),(1===t.state.robot_current_state.status||2===t.state.robot_current_state.status)&&Object(f.jsx)("div",{className:C.a.targetClick,style:{top:"".concat(t.state.robot_current_state.target[1]-5,"px"),left:"".concat(t.state.robot_current_state.target[0]-5,"px")}}),(1===t.state.robot_current_state.status||2===t.state.robot_current_state.status)&&t.renderPath()]})},t.renderPath=function(){for(var e=[],a=0;a<t.state.robot_current_state.path.length;a++)e.push(Object(f.jsx)("div",{className:C.a.targetPath,style:{left:"".concat(t.state.robot_current_state.path[a][0]-5,"px"),top:"".concat(t.state.robot_current_state.path[a][1]-5,"px")}}));return e},t.move=function(){t.state.socket.emit("moveCommand",{destination:t.state.clicked_coordinate})},t.moveRoom=function(){t.state.socket.emit("moveCommand",{destination:w[t.state.selectroom]})},t.stop=function(){t.state.socket.emit("stopCommand")},t.resume=function(){t.state.socket.emit("resumeCommand")},t.pause=function(){t.state.socket.emit("pauseCommand")},t.streamAudioData=function(e){var a=e.inputBuffer.getChannelData(0),s=Int16Array.from(a.map((function(t){var e=Math.max(-1,Math.min(1,t));return e<0?32768*e:32767*e})));t.state.socket.emit("audio",s.buffer)},t.startRecording=function(e){var a=t.state.audioContext||new AudioContext;if(t.setState({audioContext:a}),a){var s=e;t.setState({myStream:s});var n=a.createGain(),r=a.createMediaStreamSource(s),o=a.createAnalyser(),c=n.context.createScriptProcessor(2048,2,2);t.setState({scriptProcessor:c}),r.connect(n),n.connect(o),n.connect(c),c.connect(n.context.destination),c.addEventListener("audioprocess",t.streamAudioData)}},t.startrec=function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,navigator.mediaDevices.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"}}}).then(t.startRecording).catch((function(t){console.log(t)}))},t.stoprec=function(){t.state.myStream&&(t.state.myStream.getTracks()[0].stop(),t.setState({myStream:null})),t.state.scriptProcessor&&t.state.scriptProcessor.removeEventListener("audioprocess",t.streamAudioData)},t.recbuttHan=function(){t.state.voicestate?(console.log("ya"),t.stoprec(),t.state.socket.emit("stoprec"),t.setState({voicestate:!1})):(console.log("ye"),t.state.socket.emit("startnewrec"),t.setState({voicestate:!0}))},t}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var t=Object(d.a)(l.a.mark((function t(){var e,a=this;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(e=Object(S.io)("/",{query:{token:localStorage.getItem("auth")}})).on("401",(function(){a.logOut()})),e.on("authenticated",(function(t){a.setState({current_user:t})})),e.on("robotState",(function(t){var e=t.planning_state,s=a.state.robot_current_state;s.position=t.occupancy_grid_position,s.status=e.state,s.target=e.target,s.path=e.path,a.setState({occupancy_map:"data:image/png;base64, ".concat(t.map.replace(/(\r\n|\n|\r)/gm,"")),robot_current_state:s})})),e.on("transcribe",function(){var t=Object(d.a)(l.a.mark((function t(e){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==a.state.robot_current_state.status){t.next=13;break}if("deliver object to room one"!==e){t.next=7;break}return t.next=4,a.setState({selectroom:"1"});case 4:a.moveRoom(),t.next=11;break;case 7:if("deliver object to room two"!==e){t.next=11;break}return t.next=10,a.setState({selectroom:"2"});case 10:a.moveRoom();case 11:t.next=14;break;case 13:1===a.state.robot_current_state.status?"pause delivery"===e?a.pause():"stop delivery"===e&&a.stop():2===a.state.robot_current_state.status&&("resume delivery"===e?a.resume():"stop delivery"===e&&a.stop());case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.on("transcribestart",(function(){a.startrec()})),this.setState({socket:e});case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var t=Object(d.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.state.socket.disconnect();case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return Object(f.jsxs)("div",{className:C.a.Page,children:[Object(f.jsxs)("div",{className:C.a.namebox,children:["Welcome, ",Object(f.jsx)("b",{className:C.a.name,children:this.state.current_user})," ",Object(f.jsx)("div",{className:C.a.logout,onClick:this.logOut,children:"logout"})]}),Object(f.jsx)("hr",{}),Object(f.jsxs)("div",{className:C.a.columnContainer,children:[Object(f.jsxs)("div",{className:C.a.debug,children:[Object(f.jsx)("div",{className:C.a.secHead,children:"Robot Status"}),Object(f.jsxs)("div",{className:C.a.statusBox,children:[Object(f.jsx)("b",{className:C.a.statusText,children:"Status:"}),0===this.state.robot_current_state.status&&Object(f.jsx)("b",{className:C.a.greyText,children:"Idle"}),1===this.state.robot_current_state.status&&Object(f.jsx)("b",{className:C.a.greenText,children:"Moving"}),2===this.state.robot_current_state.status&&Object(f.jsx)("b",{className:C.a.yellowText,children:"Paused"})]}),Object(f.jsx)("div",{className:C.a.statusBox,children:Object(f.jsx)("b",{className:C.a.statusText,children:"Map:"})}),Object(f.jsxs)("div",{className:C.a.togglePane,children:[Object(f.jsx)("div",{children:"Beautified"}),Object(f.jsx)("div",{className:0===this.state.maptype?"".concat(C.a.toggleButton):"".concat(C.a.toggleButton," ").concat(C.a.right),onMouseDown:function(t){return t.preventDefault()},onClick:function(){t.setState({maptype:1-t.state.maptype})},children:Object(f.jsx)("div",{className:C.a.toggleDot})}),Object(f.jsx)("div",{children:"Occupancy"})]}),0===this.state.maptype?Object(f.jsxs)("div",{onMouseDown:function(t){return t.preventDefault()},className:C.a.Beautifulmap,onClick:this.clickMap,children:[Object(f.jsx)("img",{src:N}),this.renderInsideMap()]}):Object(f.jsxs)("div",{onMouseDown:function(t){return t.preventDefault()},className:C.a.Beautifulmap,onClick:this.clickMap,children:[Object(f.jsx)("img",{src:this.state.occupancy_map}),this.renderInsideMap()]})]}),Object(f.jsxs)("div",{className:C.a.debug2,children:[Object(f.jsx)("div",{className:C.a.secHead,children:"Robot Control"}),this.controlpanel()]})]})]})}}]),a}(n.a.Component),T=Object(i.f)(P);function B(){return Object(f.jsx)(c.a,{children:Object(f.jsxs)(i.c,{children:[Object(f.jsx)(i.a,{path:"/robot",children:Object(f.jsx)(T,{})}),Object(f.jsx)(i.a,{path:"/",children:Object(f.jsx)(O,{})})]})})}var D=function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,97)).then((function(e){var a=e.getCLS,s=e.getFID,n=e.getFCP,r=e.getLCP,o=e.getTTFB;a(t),s(t),n(t),r(t),o(t)}))};a(95);o.a.render(Object(f.jsx)(n.a.StrictMode,{children:Object(f.jsx)(B,{})}),document.getElementById("root")),D()}},[[96,1,2]]]);
//# sourceMappingURL=main.b408e8a3.chunk.js.map